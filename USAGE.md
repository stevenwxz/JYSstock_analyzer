# ğŸ“– ä½¿ç”¨è¯´æ˜

## ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®ç›˜è¿è¡Œ](#å®ç›˜è¿è¡Œ)
- [å†å²å›æµ‹](#å†å²å›æµ‹)
- [é…ç½®è°ƒä¼˜](#é…ç½®è°ƒä¼˜)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®é‚®ç®±ï¼ˆå¯é€‰ï¼‰

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶
# EMAIL_ADDRESS=your_email@qq.com
# EMAIL_PASSWORD=your_smtp_password
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# å•æ¬¡è¿è¡Œï¼Œç«‹å³åˆ†æ
python main.py
```

---

## å®ç›˜è¿è¡Œ

### ç«‹å³åˆ†æ

```bash
python main.py
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
ğŸ“Š å¼€å§‹åˆ†ææ²ªæ·±300è‚¡ç¥¨...
âœ… è·å–åˆ° 300 åªæ²ªæ·±300æˆåˆ†è‚¡
ğŸ” ç­›é€‰é…ç½®ï¼š
   â€¢ PEä¸Šé™: 30
   â€¢ æˆäº¤é¢: 5000ä¸‡å…ƒ
   â€¢ å¼ºåŠ¿åˆ†æ•°: â‰¥50

ğŸ† æ¨èè‚¡ç¥¨ (3åª):
   #1 è‚¡ç¥¨A (600xxx): Â¥50.00, PE=15.5, åˆ†æ•°=85
   #2 è‚¡ç¥¨B (000xxx): Â¥30.00, PE=20.2, åˆ†æ•°=78
   #3 è‚¡ç¥¨C (002xxx): Â¥25.00, PE=18.0, åˆ†æ•°=72
```

### å®šæ—¶ä»»åŠ¡

```bash
# æ¯æ—¥16:00è‡ªåŠ¨åˆ†æ
python main.py --schedule
```

å®šæ—¶ä»»åŠ¡ä¼šï¼š

1. æ¯å¤©16:00æ‰§è¡Œè‚¡ç¥¨åˆ†æ
2. 16:30è‡ªåŠ¨å‘é€é‚®ä»¶
3. ä»…å·¥ä½œæ—¥è¿è¡Œï¼ˆå¯é…ç½®ï¼‰

---

## å†å²å›æµ‹

### å•æ—¥å›æµ‹

```bash
python run_backtest_optimized.py
```

äº¤äº’å¼è¾“å…¥ï¼š

```
è¯·é€‰æ‹©å›æµ‹æ¨¡å¼:
1. å•æ—¥å›æµ‹
2. å¤šæ—¥å›æµ‹

è¯·è¾“å…¥é€‰é¡¹: 1
è¯·è¾“å…¥å›æµ‹æ—¥æœŸ: 2025-04-07
è¯·è¾“å…¥æŒæœ‰å¤©æ•°: 1
```

ç»“æœç¤ºä¾‹ï¼š

```
ğŸ“… å›æµ‹æ—¥æœŸ: 2025-04-07 | æŒæœ‰1å¤©

ğŸ† ç­›é€‰ç»“æœ (3åª):
   #1 å¤©å›ç”Ÿç‰©: Â¥21.77 â†’ Â¥22.89 (+5.14%)
   #2 é¾™æºç”µåŠ›: Â¥17.55 â†’ Â¥17.87 (+1.82%)
   #3 ä¸œé¹é¥®æ–™: Â¥250.00 â†’ Â¥251.00 (+0.40%)

ğŸ“Š ç­–ç•¥è¡¨ç°:
   â€¢ å¹³å‡æ”¶ç›Š: +2.46%
   â€¢ èƒœç‡: 100.0% (3/3)
```

### å¤šæ—¥å›æµ‹

ç”¨äºç»Ÿè®¡ä¸€æ®µæ—¶é—´çš„ç­–ç•¥è¡¨ç°ï¼š

```bash
python run_backtest_optimized.py

# é€‰æ‹©æ¨¡å¼ 2
è¯·è¾“å…¥å¼€å§‹æ—¥æœŸ: 2025-04-01
è¯·è¾“å…¥ç»“æŸæ—¥æœŸ: 2025-04-07
è¯·è¾“å…¥æŒæœ‰å¤©æ•°: 1
```

---

## é…ç½®è°ƒä¼˜

### å®ç›˜é…ç½® (`config/config.py`)

æ ¹æ®ä½ çš„é£é™©åå¥½è°ƒæ•´å‚æ•°ï¼š

#### ä¿å®ˆå‹é…ç½®

```python
STOCK_FILTER_CONFIG = {
    'max_pe_ratio': 20,          # PEæ›´ä¸¥æ ¼
    'min_turnover': 10000,   # æˆäº¤é¢1äº¿ï¼ˆè¶…å¤§ç›˜è‚¡ï¼‰
    'min_strength_score': 60,    # æ›´é«˜çš„å¼ºåŠ¿è¦æ±‚
    'max_stocks': 2              # åªæ¨è2åª
}
```

#### æ¿€è¿›å‹é…ç½®

```python
STOCK_FILTER_CONFIG = {
    'max_pe_ratio': 50,          # PEæ›´å®½æ¾
    'min_turnover': 3000,    # æˆäº¤é¢3000ä¸‡
    'min_strength_score': 40,    # é™ä½é—¨æ§›
    'max_stocks': 5              # æ¨è5åª
}
```

#### å¹³è¡¡å‹é…ç½®ï¼ˆé»˜è®¤ï¼‰

```python
STOCK_FILTER_CONFIG = {
    'max_pe_ratio': 30,
    'min_turnover': 5000,    # 5000ä¸‡
    'min_strength_score': 50,
    'max_stocks': 3
}
```

### å›æµ‹é…ç½® (`config/backtest_config.py`)

#### åŠ é€Ÿå›æµ‹ï¼ˆé™ä½ç²¾åº¦ï¼‰

```python
BACKTEST_SAMPLE_CONFIG = {
    'sample_size': 100,          # åªé‡‡æ ·100åª
    'cache_expire_days': 30      # ç¼“å­˜30å¤©
}
```

#### ç²¾ç¡®å›æµ‹ï¼ˆé»˜è®¤ï¼‰

```python
BACKTEST_SAMPLE_CONFIG = {
    'sample_size': 300,          # å…¨éƒ¨300åª
    'cache_expire_days': 7       # ç¼“å­˜7å¤©
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ¸…é™¤ç¼“å­˜ï¼Ÿ

```bash
# Linux/Mac
rm -rf cache/

# Windows
rmdir /s cache
```

### Q2: ä¸ºä»€ä¹ˆç­›é€‰ä¸å‡ºè‚¡ç¥¨ï¼Ÿ

å¯èƒ½åŸå› ï¼š

1. **å¼ºåŠ¿åˆ†æ•°å¤ªé«˜** - é™ä½ `min_strength_score` åˆ° 40
2. **æˆäº¤é¢é—¨æ§›å¤ªé«˜** - é™ä½ `min_turnover` åˆ° 3000
3. **PEè¦æ±‚å¤ªä¸¥æ ¼** - æé«˜ `max_pe_ratio` åˆ° 50
4. **å½“æ—¥å¸‚åœºè¡Œæƒ…å·®** - æ¢ä¸ªæ—¥æœŸæµ‹è¯•

è°ƒæ•´é…ç½®ï¼š

```python
# ä¸´æ—¶é™ä½è¦æ±‚
BACKTEST_FILTER_CONFIG = {
    'max_pe_ratio': 50,
    'min_turnover': 20000000,
    'min_strength_score': 30
}
```

### Q3: é‚®ä»¶å‘é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. **æ£€æŸ¥.envé…ç½®**

   ```bash
   cat .env
   # ç¡®è®¤é‚®ç®±å’Œå¯†ç æ­£ç¡®
   ```
2. **QQé‚®ç®±éœ€è¦SMTPæˆæƒç **

   - ç™»å½•QQé‚®ç®±ç½‘é¡µç‰ˆ
   - è®¾ç½® -> è´¦æˆ· -> POP3/IMAP/SMTPæœåŠ¡
   - å¼€å¯SMTPæœåŠ¡
   - ç”Ÿæˆæˆæƒç ï¼ˆ16ä½ï¼‰
   - å°†æˆæƒç å¡«å…¥ `.env` çš„ `EMAIL_PASSWORD`
3. **ç½‘ç»œé—®é¢˜**

   ```bash
   # æµ‹è¯•SMTPè¿æ¥
   telnet smtp.qq.com 587
   ```

### Q4: å›æµ‹é€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ

1. **å¯ç”¨ç¼“å­˜**ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
2. **å‡å°‘é‡‡æ ·æ•°é‡**
   ```python
   BACKTEST_SAMPLE_CONFIG = {
       'sample_size': 100  # ä»300æ”¹ä¸º100
   }
   ```
3. **å¢åŠ ç¼“å­˜æœ‰æ•ˆæœŸ**
   ```python
   'cache_expire_days': 30  # ä»7æ”¹ä¸º30
   ```

### Q5: æ•°æ®è·å–å¤±è´¥ï¼Ÿ

å¯èƒ½æ˜¯ç½‘ç»œæ³¢åŠ¨æˆ–APIé™æµï¼š

1. **ç­‰å¾…å‡ ç§’åé‡è¯•**
2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
3. **æ›´æ–°akshareç‰ˆæœ¬**
   ```bash
   pip install --upgrade akshare
   ```

### Q6: å¦‚ä½•ä¿®æ”¹æ¨èæ•°é‡ï¼Ÿ

```python
# config/config.py
STOCK_FILTER_CONFIG = {
    'max_stocks': 5  # æ”¹ä¸º5åª
}
```

### Q7: å¦‚ä½•åªåˆ†æç‰¹å®šæ—¥æœŸï¼Ÿ

```bash
python run_backtest_optimized.py
# é€‰æ‹©æ¨¡å¼1ï¼Œè¾“å…¥å…·ä½“æ—¥æœŸ
```

### Q8: å¼ºåŠ¿åˆ†æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ

```
æ€»åˆ† = æ¶¨è·Œå¹…(30%) + åŠ¨é‡(40%) + æˆäº¤é¢(20%) + ä»·æ ¼(10%)

ç¤ºä¾‹ï¼š
- å½“æ—¥æ¶¨5% â†’ 30åˆ†
- 20æ—¥æ¶¨12% â†’ 30åˆ†
- æˆäº¤é¢>1.5äº¿ â†’ 15åˆ†
- è‚¡ä»·>1å…ƒ â†’ 10åˆ†
æ€»åˆ† = 30 + 30 + 15 + 10 = 85åˆ†
```

---

## è¿›é˜¶ç”¨æ³•

### 1. æ‰¹é‡å›æµ‹

åˆ›å»ºè„šæœ¬ `batch_backtest.py`ï¼š

```python
from run_backtest_optimized import OptimizedBacktest

backtest = OptimizedBacktest()

dates = ['2025-04-01', '2025-04-02', '2025-04-03']
for date in dates:
    print(f"\nå›æµ‹æ—¥æœŸ: {date}")
    result = backtest.backtest_single_day(date, hold_days=1)
```

### 2. è‡ªå®šä¹‰ç­›é€‰é€»è¾‘

ç¼–è¾‘ `src/analysis/stock_filter.py` ä¸­çš„ `calculate_strength_score` æ–¹æ³•ã€‚

### 3. å¯¼å‡ºåˆ°Excel

```python
import pandas as pd
import json

# è¯»å–å›æµ‹ç»“æœ
with open('backtest_opt_2025-04-07_1days.json', 'r') as f:
    data = json.load(f)

# è½¬ä¸ºDataFrame
df = pd.DataFrame(data['performance'])
df.to_excel('å›æµ‹ç»“æœ.xlsx', index=False)
```

---

## æœ€ä½³å®è·µ

1. **å…ˆå›æµ‹å†å®ç›˜** - ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥
2. **å®šæœŸæ¸…ç†ç¼“å­˜** - æ¯å‘¨æ¸…ç†ä¸€æ¬¡ï¼Œä¿æŒæ•°æ®æ–°é²œ
3. **åˆ†æ•£æŠ•èµ„** - ä¸è¦åªä¹°æ¨èçš„è‚¡ç¥¨
4. **è®¾ç½®æ­¢æŸ** - äºæŸè¶…è¿‡5%åŠæ—¶æ­¢æŸ
5. **é•¿æœŸè·Ÿè¸ª** - è®°å½•æ¯æ—¥æ¨èï¼Œç»Ÿè®¡å®é™…èƒœç‡

---

## è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹[å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
2. æäº¤Issue
3. æŸ¥çœ‹ä»£ç æ³¨é‡Š

---

â­ å¦‚æœè¿™ä¸ªæ–‡æ¡£å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç»™é¡¹ç›®ç‚¹ä¸ªStarï¼
