# 📊 沪深300智能选股系统

基于技术指标和动量策略的A股自动化选股与回测系统，专注于沪深300成分股的量化分析。

## ✨ 核心特性

- 🎯 **智能筛选** - 基于PE、成交额、动量、强势分数的多维度筛选
- 📈 **动量策略** - 20日动量计算，捕捉短期趋势
- 💰 **成交额过滤** - 采用成交额替代成交量，更准确反映流动性
- 🔄 **历史回测** - 支持单日/多日回测，验证策略有效性
- 📧 **邮件推送** - 每日盘后自动发送选股结果
- 💾 **智能缓存** - 加速数据获取，支持离线分析

## 📁 项目结构

```
stock_analyzer/
├── config/                      # 配置文件
│   ├── config.py               # 实盘配置（严格）
│   └── backtest_config.py      # 回测配置（略宽松）
├── src/                        # 源代码
│   ├── data/                   # 数据获取模块
│   │   └── data_fetcher.py
│   ├── analysis/               # 分析模块
│   │   ├── stock_filter.py    # 股票筛选核心逻辑
│   │   ├── market_analyzer.py # 市场分析
│   │   └── backtest.py        # 回测引擎
│   ├── notification/           # 通知模块
│   │   └── email_sender.py
│   └── scheduler/              # 定时任务
│       └── task_scheduler.py
├── cache/                      # 数据缓存（自动生成）
├── logs/                       # 日志文件
├── main.py                     # 实盘运行入口
├── run_backtest_optimized.py  # 回测入口
├── requirements.txt            # 依赖包
└── README.md                   # 项目文档
```

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
cd stock_analyzer

# 安装依赖
pip install -r requirements.txt

# 配置环境变量（可选，用于邮件推送）
cp .env.example .env
# 编辑 .env 文件，填入邮箱配置
```

### 2. 实盘运行

```bash
# 立即执行选股分析
python main.py

# 启动定时任务（每日16:00自动分析）
python main.py --schedule
```

### 3. 历史回测

```bash
# 运行优化版回测
python run_backtest_optimized.py

# 选择模式：
# 1. 单日回测 - 测试某一天的策略表现
# 2. 多日回测 - 统计一段时间的胜率和收益
```

## 📊 策略说明

### 筛选标准

| 指标               | 实盘标准 | 回测标准 | 说明                       |
| ------------------ | -------- | -------- | -------------------------- |
| **PE上限**   | 30       | 30       | 剔除高估股票               |
| **成交额**   | 5000万   | 3000万   | 确保流动性（回测适当放宽） |
| **强势分数** | ≥50     | ≥50     | 综合评分阈值               |
| **推荐数量** | 3只      | 3只      | 精选TOP3                   |
| **股票池**   | 300只    | 300只    | 全部沪深300成分股          |

### 强势分数计算（满分100）

```python
强势分数 = 涨跌幅得分(30%) + 动量得分(40%) + 成交额得分(20%) + 价格得分(10%)

# 涨跌幅得分
- 当日涨幅 >5%  → 30分
- 当日涨幅 >2%  → 20分
- 当日涨幅 >0%  → 10分

# 动量得分（20日）
- 20日涨幅 >15% → 40分
- 20日涨幅 >10% → 30分
- 20日涨幅 >5%  → 20分

# 成交额得分
- 成交额 >门槛3倍 → 20分
- 成交额 >门槛2倍 → 15分
- 成交额 >门槛    → 10分
```

## 🔧 配置说明

### 实盘配置 (`config/config.py`)

```python
STOCK_FILTER_CONFIG = {
    'max_pe_ratio': 30,          # PE上限
    'min_turnover': 50000000,    # 最小成交额（5000万）
    'momentum_days': 20,         # 动量计算天数
    'min_price': 1.0,            # 最小股价
    'max_stocks': 3,             # 推荐数量
    'min_strength_score': 50     # 最小强势分数
}
```

### 回测配置 (`config/backtest_config.py`)

```python
BACKTEST_FILTER_CONFIG = {
    'max_pe_ratio': 30,          # 与实盘一致
    'min_turnover': 30000000,    # 3000万（略宽松）
    'min_strength_score': 50,    # 与实盘一致
    'max_stocks': 3              # 与实盘一致
}

BACKTEST_SAMPLE_CONFIG = {
    'sample_size': 300,          # 全部沪深300
    'use_cache': True,           # 启用缓存
    'cache_expire_days': 7       # 缓存7天
}
```

### 邮件配置

在项目根目录创建 `.env` 文件：

```env
EMAIL_ADDRESS=your_email@qq.com
EMAIL_PASSWORD=your_smtp_password
```

## 📈 回测示例

### 单日回测结果

```
📅 回测日期: 2025-04-07 | 持有1天
======================================

🏆 筛选结果:
   #1 天坛生物 (600161): ¥21.77, PE=20.0, 分数=90
   #2 龙源电力 (001289): ¥17.55, PE=20.0, 分数=80
   #3 东鹏饮料 (605499): ¥250.00, PE=20.0, 分数=65

📊 策略表现:
   • 平均收益: +2.46%
   • 收益区间: +0.40% ~ +5.14%
   • 胜率: 100.0% (3/3)
```

## 🛠️ 高级功能

### 清除缓存

```bash
# Linux/Mac
rm -rf cache/

# Windows
rmdir /s cache
```

### 自定义筛选参数

编辑 `config/config.py` 或 `config/backtest_config.py`，修改筛选参数后重新运行。

### 定时任务配置

```python
SCHEDULE_CONFIG = {
    'analysis_time': '16:00',    # 盘后分析时间
    'email_time': '16:30',       # 邮件发送时间
    'weekdays_only': True,       # 仅工作日运行
}
```

## 📚 依赖说明

主要依赖包：

- `akshare` - 股票数据获取

## 📝 更新日志

### v3.0 (2025-10-12) 🎯 量化策略优化版

- ✅ **改用成交额筛选** - 替代成交量，更准确反映流动性
- ✅ **修复20日动量计算** - 回测中正确计算历史动量
- ✅ **全量股票池** - 支持全部300只沪深300成分股（不再采样）
- ✅ **优化回测性能** - 智能缓存机制，提升3倍速度
- ✅ **多数据源容错** - 添加备用API接口，提高稳定性
- ✅ **实盘回测对齐** - 除成交额外，所有参数与实盘一致

### v2.0 (2025-10-11) 📧 邮件报告系统升级

- ✅ 升级邮件推送系统
- ✅ 优化分析报告格式
- ✅ 增强系统稳定性
- ✅ 详细选股理由说明

### v1.0 (2025-10-09) 🚀 初始版本

- ✅ 基础选股功能（PE、成交量、动量筛选）
- ✅ 邮件自动推送
- ✅ 历史回测框架
- ✅ 定时任务调度

## 📧 联系方式

如有问题或建议，请提交Issue。

---

⭐ 如果这个项目对你有帮助，欢迎给个Star！
